frontend rp-vault
    bind :${PROXY_EDGE_VAULT_PORT} name rp-vault-s ssl crt "/etc/ssl/certs/${PROJECT_HOSTNAME}/combined.pem"
    maxconn ${PROXY_MAXCONN_PRIV}

    http-request deny if { path -m sub /. }
    # temporary until https://github.com/hashicorp/nomad/issues/15629
    # http-request deny if { req.hdr(user-agent) -m len le 32 }
    http-request deny if HTTP_1.0

    http-request redirect scheme https code 301 unless { ssl_fc }
    use_backend lb-vault

backend lb-vault
    server-template vault- 1 "${PROXY_VAULT_HOSTNAME}:${PROXY_VAULT_PORT}"  ssl verify none maxconn ${PROXY_MAXCONN_PRIV} resolvers docker
